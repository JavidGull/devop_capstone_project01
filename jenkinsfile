pipeline
{

agent {
  label any
}


parameters {
    choice choices: ['dev', 'prod'], name: 'select_environment'
}

environment{
    NAME = "javid"
}
tools {
  maven 'mymaven'
}

stages{

    stage('build')
    {
        steps {
            sh 'mvn clean package -DskipTests=true'
        }
    }

    stage('buildtest')
    { 
 //       agent { label 'DevServer' }
        steps{
            echo " Test Execution...."
            sh "mvn test"
        }
    }

    stage('deploy_dev')
    {
        when { expression {params.select_environment == 'dev'}
        beforeAgent true}
//        agent { label 'DevServer' }
        steps
        {
          dir("data"){
            sh 'sudo docker build -f ./dockerfile -t caps_project01'    
           } 
        }
    }

  } 
}